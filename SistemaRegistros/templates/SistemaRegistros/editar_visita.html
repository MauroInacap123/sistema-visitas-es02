{% extends 'SistemaRegistros/base.html' %}
{% load static %}

{% block title %}Editar Visita{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'SistemaRegistros/css/editar_visita.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <!-- Header -->
  <div class="page-header">
    <h3>
      <i class="bi bi-pencil-square"></i>
      Editar Visita
    </h3>
    <p>Modificar información de la visita de <strong>{{ visita.nombre }}</strong></p>
  </div>

  <!-- Formulario -->
  <div class="form-container">
    <form method="post">
      {% csrf_token %}
      
      <div class="row">
        <!-- RUT -->
        <div class="col-md-6 mb-3">
          <label for="{{ form.rut.id_for_label }}" class="form-label">
            <i class="bi bi-credit-card"></i> RUT <span class="required">*</span>
          </label>
          {{ form.rut }}
          {% if form.rut.errors %}
            <div class="text-danger">
              {{ form.rut.errors }}
            </div>
          {% endif %}
        </div>

        <!-- Nombre -->
        <div class="col-md-6 mb-3">
          <label for="{{ form.nombre.id_for_label }}" class="form-label">
            <i class="bi bi-person"></i> Nombre Completo <span class="required">*</span>
          </label>
          {{ form.nombre }}
          {% if form.nombre.errors %}
            <div class="text-danger">
              {{ form.nombre.errors }}
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Motivo -->
      <div class="mb-3">
        <label for="{{ form.motivo_visita.id_for_label }}" class="form-label">
          <i class="bi bi-chat-dots"></i> Motivo de la Visita <span class="required">*</span>
        </label>
        {{ form.motivo_visita }}
        {% if form.motivo_visita.errors %}
          <div class="text-danger">
            {{ form.motivo_visita.errors }}
          </div>
        {% endif %}
      </div>

      <div class="row">
        <!-- Fecha -->
        <div class="col-md-4 mb-3">
          <label for="{{ form.fecha_visita.id_for_label }}" class="form-label">
            <i class="bi bi-calendar"></i> Fecha <span class="required">*</span>
          </label>
          {{ form.fecha_visita }}
          {% if form.fecha_visita.errors %}
            <div class="text-danger">
              {{ form.fecha_visita.errors }}
            </div>
          {% endif %}
        </div>

        <!-- Hora Entrada -->
        <div class="col-md-4 mb-3">
          <label for="{{ form.hora_entrada.id_for_label }}" class="form-label">
            <i class="bi bi-clock"></i> Hora Entrada <span class="required">*</span>
          </label>
          {{ form.hora_entrada }}
          {% if form.hora_entrada.errors %}
            <div class="text-danger">
              {{ form.hora_entrada.errors }}
            </div>
          {% endif %}
        </div>

        <!-- Hora Salida -->
        <div class="col-md-4 mb-3">
          <label for="{{ form.hora_salida.id_for_label }}" class="form-label">
            <i class="bi bi-clock-history"></i> Hora Salida
          </label>
          {{ form.hora_salida }}
          {% if form.hora_salida.errors %}
            <div class="text-danger">
              {{ form.hora_salida.errors }}
            </div>
          {% endif %}
          <small class="text-muted">Opcional</small>
        </div>
      </div>

      <!-- Estado -->
      <div class="mb-4">
        <label for="{{ form.estado.id_for_label }}" class="form-label">
          <i class="bi bi-flag"></i> Estado <span class="required">*</span>
        </label>
        {{ form.estado }}
        {% if form.estado.errors %}
          <div class="text-danger">
            {{ form.estado.errors }}
          </div>
        {% endif %}
      </div>

      <!-- Errores generales -->
      {% if form.non_field_errors %}
        <div class="alert alert-danger">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <!-- Botones -->
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-success">
          <i class="bi bi-check-circle"></i> Guardar Cambios
        </button>
        <a href="{% url 'lista_visitas' %}" class="btn btn-secondary">
          <i class="bi bi-x-circle"></i> Cancelar
        </a>
      </div>
    </form>
  </div>

  <!-- Información adicional -->
  <div class="info-card">
    <h6><i class="bi bi-info-circle"></i> Información de la Visita</h6>
    <ul>
      <li><strong>RUT actual:</strong> {{ visita.rut }}</li>
      <li><strong>Estado actual:</strong> 
        {% if visita.estado == 'EN_CURSO' %}
          En Curso
        {% else %}
          Finalizada
        {% endif %}
      </li>
      <li>Los campos marcados con <span class="required">*</span> son obligatorios</li>
    </ul>
  </div>
</div>
{% endblock %}